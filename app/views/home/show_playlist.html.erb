<%= render 'shared/theme_toggle' %>

<div class="max-w-screen-lg mx-auto px-4 mb-4 pb-12" data-controller="playlist-chords">
  <div class="flex items-center justify-between mb-4">
    <%= link_to "#{app_path}#playlists", class: "btn btn-ghost btn-sm" do %>
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
      </svg>
      Volver
    <% end %>

    <% if @playlist.songs.any? { |song| song.chordpro_content.present? } %>
      <button
        class="btn btn-xs sm:btn-sm btn-primary flex items-center"
        data-playlist-chords-target="toggleButton"
        data-action="click->playlist-chords#toggle"
        type="button">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-playlist-chords-target="iconChords">
          <path d="M9 18V5l12-2v13"></path>
          <circle cx="6" cy="18" r="3"></circle>
          <circle cx="18" cy="16" r="3"></circle>
        </svg>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:mr-1 hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-playlist-chords-target="iconLyrics">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        <span class="hidden sm:inline" data-playlist-chords-target="buttonText">Ver Acordes</span>
      </button>
    <% end %>
  </div>

  <div class="py-3">
    <h1 class="text-2xl sm:text-3xl font-extrabold text-center">
      <%= @playlist.name.titleize %>
    </h1>
  </div>

  <% @playlist.playlist_sections.each do |p_section| %>
    <div class="mb-10">
      <% if p_section.name.present? %>
        <h2 class="text-xl font-bold break-words text-center mb-6 mt-4 px-4"><%= p_section.name.titleize %></h2>
        <div class="divider my-0"></div>
      <% end %>

      <div class="space-y-8">
        <% p_section.playlist_items.each do |p_item| %>
          <div class="card bg-base-200 shadow-md">
            <div class="card-body">
              <h3 class="card-title text-lg">
                <%= "#{p_item.position}. #{p_item.song.title.titleize}" %>
              </h3>

              <%# Lyrics content (shown by default) %>
              <div class="prose max-w-none break-words" data-playlist-chords-target="content">
                <%= simple_format(p_item.song.content) %>
              </div>

              <%# Chords content (hidden by default) %>
              <% if p_item.song.chordpro_content.present? %>
                <div class="hidden" data-playlist-chords-target="chords" data-controller="chordpro-preview">
                  <textarea
                    style="display: none;"
                    data-chordpro-preview-target="input"><%= p_item.song.chordpro_content %></textarea>

                  <div
                    data-chordpro-preview-target="preview"
                    class="chordpro-modal-preview">
                    <!-- ChordPro content will be rendered here -->
                  </div>
                </div>
              <% else %>
                <%# If no chords, show content again so toggle doesn't hide it %>
                <div class="hidden prose max-w-none break-words" data-playlist-chords-target="chords">
                  <%= simple_format(p_item.song.content) %>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>

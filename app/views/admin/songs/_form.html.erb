<%= semantic_form_for [:admin, @song], builder: ActiveAdmin::FormBuilder, html: { class: 'song-form-with-sticky-actions' } do |f| %>
  <!-- Fixed/Sticky Action Bar -->
  <div class="sticky-form-actions">
    <div class="sticky-actions-content">
      <%= f.submit "Save Song", class: "button primary" %>
      <%= link_to "Cancel", admin_songs_path, class: "button cancel" %>
    </div>
  </div>

  <!-- Basic Fields -->
  <%= f.inputs do %>
    <%= f.input :title %>
    <%= f.input :position %>
    <%= f.input :content %>
    <%= f.input :author %>
  <% end %>

  <!-- ChordPro Editor with Live Preview -->
  <%= f.inputs "ChordPro Editor", class: 'chordpro-editor-section' do %>
    <div class="chordpro-editor-container" data-controller="chordpro-preview">
      <div class="chordpro-editor-layout">
        <!-- Left: Textarea -->
        <div class="chordpro-textarea-wrapper">
          <label for="song_chordpro_content">ChordPro Content</label>
          <%= f.text_area :chordpro_content,
                          rows: 20,
                          data: {
                            'chordpro-preview-target': 'input',
                            'action': 'input->chordpro-preview#onInput'
                          },
                          placeholder: "{title: Song Title}\n{artist: Artist Name}\n{key: G}\n\n{section:Verse 1}\n[G]Amazing grace how [C]sweet the [G]sound\nThat saved a wretch like [D]me" %>
        </div>

        <!-- Right: Preview Panel -->
        <div class="chordpro-preview-wrapper">
          <h4>Live Preview</h4>
          <div class="chordpro-error hidden" data-chordpro-preview-target="error"></div>
          <div class="chordpro-preview-panel" data-chordpro-preview-target="preview">
            <p class="placeholder-text">Preview will appear here...</p>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <!-- Slide Preview (for existing songs) -->
  <% if @song.persisted? %>
    <div class="panel" id="song-slide">
      <h3>Slide</h3>
      <%= render partial: "iframe", locals: { song: @song } %>
    </div>
  <% end %>

  <!-- Video Links -->
  <% f.has_many :video_links, heading: 'Video Links', allow_destroy: true do |f_vl| %>
    <% f_vl.input :provider %>
    <% f_vl.input :url %>
  <% end %>

  <%= f.actions %>
<% end %>
